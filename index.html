<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moradas Marília 1</title>
    <!-- Inclui o Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a fonte Inter para toda a página */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
        }

        /* Estilo para o modal de mensagem */
        .modal {
            display: none; /* Oculta o modal por padrão */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 32rem;
            width: 100%;
            position: relative;
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .loading-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 p-4 flex flex-col items-center">

    <!-- Cabeçalho principal com botões de navegação -->
    <header class="w-full max-w-4xl flex justify-between items-center py-4 px-6 bg-white rounded-xl shadow-lg mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Moradas Marília 1</h1>
        <nav class="space-x-4">
            <button id="public-btn" class="px-4 py-2 rounded-lg font-medium transition-colors duration-300 bg-indigo-600 text-white shadow-md">
                Serviços
            </button>
            <button id="admin-btn" class="px-4 py-2 rounded-lg font-medium transition-colors duration-300 text-gray-600 hover:text-indigo-600">
                Administrador
            </button>
        </nav>
    </header>

    <!-- Container principal para o conteúdo dinâmico -->
    <div id="content" class="w-full max-w-4xl"></div>
    
    <!-- Modal para exibir mensagens geradas pela API -->
    <div id="message-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Mensagem Gerada ✨</h3>
            <p id="modal-text" class="text-gray-700 mb-4 whitespace-pre-wrap"></p>
            <div class="modal-buttons">
              <button id="copy-btn" class="flex-1 py-2 px-4 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors duration-300">
                  Copiar Mensagem
              </button>
              <button id="close-btn" class="flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-bold rounded-lg hover:bg-gray-300 transition-colors duration-300">
                  Fechar
              </button>
            </div>
        </div>
    </div>

    <!-- Modal de carregamento para a API -->
    <div id="loading-modal" class="loading-modal">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <p class="text-gray-700">Gerando mensagem...</p>
        </div>
    </div>

    <!-- Script principal da aplicação -->
    <script>
        // Dados iniciais dos fornecedores
        let providers = [
            { id: 1, name: 'João da Silva', service: 'Eletricista', casa: '201', contact: '14 99999-9999' },
            { id: 2, name: 'Maria Souza', service: 'Manicure e Pedicure', casa: '503', contact: '14 98888-8888' },
            { id: 3, name: 'Pedro Alves', service: 'Professor de Inglês', casa: '102', contact: '14 97777-7777' },
            { id: 4, name: 'Ana Costa', service: 'Doces e Bolos', casa: '304', contact: '14 96666-6666' },
            { id: 5, name: 'Carlos Ferreira', service: 'Encanador', casa: '405', contact: '14 95555-5555' },
        ];
        
        // Variáveis de estado
        let view = 'public';
        let adminLoggedIn = false;
        let searchTerm = '';
        let form = { name: '', service: '', casa: '', contact: '' };
        
        // Credenciais do administrador (simulado)
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = '12345';

        // Referências aos elementos do DOM
        const contentDiv = document.getElementById('content');
        const publicBtn = document.getElementById('public-btn');
        const adminBtn = document.getElementById('admin-btn');
        const messageModal = document.getElementById('message-modal');
        const modalText = document.getElementById('modal-text');
        const copyBtn = document.getElementById('copy-btn');
        const closeBtn = document.getElementById('close-btn');
        const loadingModal = document.getElementById('loading-modal');

        // Função principal para renderizar a página
        function render() {
            if (view === 'public') {
                renderPublicPage();
            } else {
                renderAdminPage();
            }
        }

        // Função para renderizar a página pública
        function renderPublicPage() {
            // Estiliza os botões de navegação
            publicBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
            publicBtn.classList.remove('text-gray-600', 'hover:text-indigo-600');
            adminBtn.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
            adminBtn.classList.add('text-gray-600', 'hover:text-indigo-600');
            
            // Filtra os fornecedores com base no termo de busca
            const filteredProviders = providers.filter(provider =>
                provider.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                provider.service.toLowerCase().includes(searchTerm.toLowerCase())
            );

            // Cria o HTML da página pública
            let publicHtml = `
                <main class="w-full max-w-4xl">
                    <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Serviços e Talentos dos Moradores</h2>
                    <div class="mb-6">
                        <input
                            type="text"
                            id="search-input"
                            placeholder="Buscar por nome ou serviço..."
                            value="${searchTerm}"
                            class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500 transition-colors duration-300 shadow-sm"
                        />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${filteredProviders.length > 0
                            ? filteredProviders.map(provider => `
                                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-300 flex flex-col justify-between">
                                    <div>
                                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${provider.name}</h3>
                                        <p class="text-indigo-600 font-medium mb-3">${provider.service}</p>
                                        <div class="text-sm text-gray-600 mb-4">
                                            <p>Casa: <span class="font-semibold">${provider.casa}</span></p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col space-y-2 mt-4">
                                        <button
                                            class="generate-message-btn w-full text-center bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-600 transition-colors duration-300"
                                            data-name="${provider.name}"
                                            data-service="${provider.service}"
                                        >
                                            ✨ Gerar Mensagem
                                        </button>
                                        <a
                                            href="https://wa.me/55${provider.contact.replace(/\D/g, '')}"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="inline-block w-full text-center bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-300"
                                        >
                                            Entrar em Contato
                                        </a>
                                    </div>
                                </div>
                            `).join('')
                            : `<p class="col-span-full text-center text-gray-500">Nenhum serviço encontrado. Tente outra busca!</p>`
                        }
                    </div>
                </main>
            `;
            contentDiv.innerHTML = publicHtml;

            // Adiciona event listeners para a barra de busca e botões de mensagem
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                renderPublicPage();
            });

            document.querySelectorAll('.generate-message-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const name = e.target.dataset.name;
                    const service = e.target.dataset.service;
                    generateContactMessage(name, service);
                });
            });
        }

        // Função para renderizar a página do administrador
        function renderAdminPage() {
            // Estiliza os botões de navegação
            adminBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
            adminBtn.classList.remove('text-gray-600', 'hover:text-indigo-600');
            publicBtn.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
            publicBtn.classList.add('text-gray-600', 'hover:text-indigo-600');
            
            // Renderiza o painel de login ou o painel de administração
            if (!adminLoggedIn) {
                contentDiv.innerHTML = `
                    <div class="w-full max-w-md p-8 bg-white rounded-xl shadow-lg">
                        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Acesso Administrativo</h2>
                        <form id="admin-login-form" class="space-y-4">
                            <div class="flex flex-col">
                                <label for="username" class="text-gray-700 mb-1">Nome de Usuário</label>
                                <input type="text" id="username" name="username" required class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                            </div>
                            <div class="flex flex-col">
                                <label for="password" class="text-gray-700 mb-1">Senha</label>
                                <input type="password" id="password" name="password" required class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                            </div>
                            <p id="login-error-message" class="text-red-500 text-center hidden">Usuário ou senha inválidos.</p>
                            <button type="submit" class="w-full py-3 px-6 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-300">
                                Entrar
                            </button>
                        </form>
                    </div>
                `;
                
                // Adiciona o event listener para o formulário de login
                const loginForm = document.getElementById('admin-login-form');
                const errorMessage = document.getElementById('login-error-message');
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = e.target.username.value;
                    const password = e.target.password.value;
                    
                    if (username === ADMIN_USER && password === ADMIN_PASS) {
                        adminLoggedIn = true;
                        errorMessage.classList.add('hidden');
                        renderAdminPage();
                    } else {
                        errorMessage.classList.remove('hidden');
                    }
                });
            } else {
                let adminHtml = `
                    <main class="w-full max-w-4xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-gray-800">Painel do Administrador</h2>
                            <button id="logout-btn" class="py-2 px-4 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition-colors duration-300">
                                Sair
                            </button>
                        </div>

                        <!-- Formulário para adicionar novo fornecedor -->
                        <div class="bg-white p-8 rounded-xl shadow-lg mb-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Adicionar Novo Fornecedor</h3>
                            <form id="add-provider-form" class="space-y-4">
                                <div class="flex flex-col">
                                    <label for="name" class="text-gray-700 mb-1">Nome</label>
                                    <input type="text" id="name" name="name" value="${form.name}" required class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div class="flex flex-col">
                                    <label for="service" class="text-gray-700 mb-1 flex justify-between items-center">
                                        <span>Serviço</span>
                                        <button
                                            type="button"
                                            id="generate-description-btn"
                                            class="text-xs bg-purple-500 text-white rounded-full px-2 py-1 hover:bg-purple-600 transition-colors duration-300"
                                        >
                                            ✨ Gerar Descrição
                                        </button>
                                    </label>
                                    <textarea
                                        id="service"
                                        name="service"
                                        value="${form.service}"
                                        required
                                        class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 min-h-[100px]"
                                        rows="4"
                                    ></textarea>
                                </div>
                                <div class="flex flex-col">
                                    <label for="casa" class="text-gray-700 mb-1">Casa</label>
                                    <input type="text" id="casa" name="casa" value="${form.casa}" required class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div class="flex flex-col">
                                    <label for="contact" class="text-gray-700 mb-1">Contato (WhatsApp)</label>
                                    <input type="text" id="contact" name="contact" value="${form.contact}" required class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <button type="submit" id="submit-btn" class="w-full py-3 px-6 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-300">
                                    Adicionar Fornecedor
                                </button>
                            </form>
                        </div>

                        <!-- Tabela de fornecedores existentes -->
                        <div class="bg-white p-8 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Fornecedores Cadastrados</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full table-auto">
                                    <thead>
                                        <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                            <th class="py-3 px-6 text-left">Nome</th>
                                            <th class="py-3 px-6 text-left">Serviço</th>
                                            <th class="py-3 px-6 text-left">Casa</th>
                                            <th class="py-3 px-6 text-left">Contato</th>
                                            <th class="py-3 px-6 text-center">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600 text-sm font-light">
                                        ${providers.map(provider => `
                                            <tr class="border-b border-gray-200 hover:bg-gray-50">
                                                <td class="py-3 px-6 whitespace-nowrap">${provider.name}</td>
                                                <td class="py-3 px-6">${provider.service}</td>
                                                <td class="py-3 px-6">${provider.casa}</td>
                                                <td class="py-3 px-6">${provider.contact}</td>
                                                <td class="py-3 px-6 text-center space-x-2">
                                                    <button class="text-blue-500 hover:text-blue-700 font-bold transition-colors duration-300">Editar</button>
                                                    <button class="remove-btn text-red-500 hover:text-red-700 font-bold transition-colors duration-300" data-id="${provider.id}">
                                                        Remover
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                `;
                contentDiv.innerHTML = adminHtml;

                // Adiciona event listeners para o painel de administração
                document.getElementById('logout-btn').addEventListener('click', () => {
                    adminLoggedIn = false;
                    renderAdminPage();
                });
                
                const formElement = document.getElementById('add-provider-form');
                formElement.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Obtém os dados do formulário
                    const newProvider = {
                        id: providers.length + 1,
                        name: formElement.name.value,
                        service: formElement.service.value,
                        casa: formElement.casa.value,
                        contact: formElement.contact.value,
                    };
                    providers.push(newProvider); // Adiciona o novo fornecedor
                    form = { name: '', service: '', casa: '', contact: '' }; // Limpa o formulário
                    renderAdminPage();
                });

                document.getElementById('generate-description-btn').addEventListener('click', async () => {
                    const serviceInput = document.getElementById('service');
                    const serviceName = serviceInput.value;
                    const prompt = `Crie uma descrição de serviço curta e profissional para um fornecedor no condomínio. O serviço é: "${serviceName}". A descrição deve ser amigável e destacar o benefício para os moradores.`;
                    
                    loadingModal.style.display = 'flex';
                    try {
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            serviceInput.value = text.trim().replace(/^"|"$/g, '');
                        }
                    } catch (error) {
                        console.error("Erro ao chamar a API Gemini:", error);
                    } finally {
                        loadingModal.style.display = 'none';
                    }
                });
                
                document.querySelectorAll('.remove-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        if (window.confirm('Tem certeza que deseja remover este fornecedor?')) {
                            providers = providers.filter(p => p.id !== id);
                            renderAdminPage();
                        }
                    });
                });
            }
        }
        
        // Função para gerar uma mensagem de contato usando a API Gemini
        async function generateContactMessage(name, service) {
            loadingModal.style.display = 'flex';
            try {
                const prompt = `Crie uma mensagem de rascunho curta e amigável para o WhatsApp para entrar em contato com um prestador de serviços. Inclua uma saudação, o nome do prestador e o serviço que ele oferece. O nome do prestador é "${name}" e o serviço é "${service}".`;
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    showModal(text);
                } else {
                    showModal("Não foi possível gerar a mensagem. Por favor, tente novamente.");
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini:", error);
                showModal("Erro ao gerar a mensagem. Por favor, tente novamente.");
            } finally {
                loadingModal.style.display = 'none';
            }
        }
        
        // Mostra o modal com a mensagem
        function showModal(message) {
            modalText.innerText = message;
            messageModal.style.display = 'flex';
        }

        // Lida com o evento de clique do botão Copiar
        copyBtn.addEventListener('click', () => {
            const textToCopy = modalText.innerText;
            try {
                // Usa execCommand para compatibilidade em ambientes restritos (como iframes)
                const tempInput = document.createElement('textarea');
                tempInput.value = textToCopy;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showModal("Mensagem copiada para a área de transferência!");
            } catch (err) {
                console.error("Falha ao copiar a mensagem: ", err);
                showModal("Não foi possível copiar a mensagem. Por favor, selecione e copie manualmente.");
            }
        });

        // Lida com o evento de clique do botão Fechar
        closeBtn.addEventListener('click', () => {
            messageModal.style.display = 'none';
        });

        // Event listeners para a navegação principal
        publicBtn.addEventListener('click', () => {
            view = 'public';
            render();
        });

        adminBtn.addEventListener('click', () => {
            view = 'admin';
            render();
        });

        // Renderiza a página inicial
        render();
    </script>
</body>
</html>
